<!DOCTYPE html>
<html>
	<head>
		<meta charset="UTF-8">
		<title></title>
		<script type="text/javascript" src="js/jquery-3.2.1.min.js" ></script>
		<script type="text/javascript" src="js/bootstrap/bootstrap.min.js" ></script>
		<link rel="stylesheet" href="css/bootstrap/bootstrap-theme.min.css" />
		<link rel="stylesheet" href="css/bootstrap/bootstrap.min.css" />
		<style>
			#myRange{
				border-radius: 50%;
			}
		</style>
	<script>
		function getLatestSongs(){
			$.ajax({
				type:"post",
				url:"getlatestsongs.do",
				async:false,
				success:function(data){
					alert(data);
					data = eval(data);
					$(data).each(function(index){
						window.player.addSong(data[index]);
					});

					alert(window.player.playLst);
				}
			});
		}
		$(function(){
			initPlayer();
			
			window.player = new Player("#player");
			$("#q").click(function(){
				getLatestSongs();
			});
			$("#play").click(function(){
				window.player.play();
			});
			$("#last").click(function(){
				window.player.lastSong();
			});
			$("#next").click(function(){
				window.player.nextSong();
			});
			$("#pause").click(function(){
				window.player.pause();
			});
			
			//var pro = setInterval("getProgress()", 1000);
			$("#player").on("timeupdate", function(){
				getProgress();
			});
			
			$(".progress").on("click", function(e){
				var player = $("#player")[0];
				var w = $(this).width();
				var x = e.offsetX;
				var percent = (x / w).toFixed(3);
				player.currentTime = (player.duration * percent).toFixed(0);
				$(".progress").children().width(percent+"%");
			});
		});
		
		function Player(selector){
			this.player = $(selector)[0];
			this.curPlay = 0;
			this.playLst = new Array();
			
			
			Player.prototype.play=function(){
				if(this.playLst.length != 0){
					if(!this.player.src){
						this.player.src = this.playLst[this.curPlay].url; 
					}
					this.player.play();
				}
			}
			
			Player.prototype.pause=function(){
				this.player.pause();
			}
			
			
			
			Player.prototype.addSong=function(obj){
				this.playLst.push(obj);
			}
			Player.prototype.addSongs=function(objs){
				this.playLst.concat(objs);
			}
			Player.prototype.delSong=function(index){
				this.playLst.splice(index, 1);
			}
			Player.prototype.nextSong=function(){
				this.curPlay = (this.curPlay + 1) % this.playLst.length;
				this.player.src = this.playLst[this.curPlay].url; 
				this.player.play();
			}
			Player.prototype.lastSong=function(){
				this.curPlay = (this.curPlay - 1 + this.playLst.length) % this.playLst.length;
				this.player.src = this.playLst[this.curPlay].url; 
				this.player.play();
			}
		}
		
		
		
		function initPlayer(){
			var player = $("#player")[0];
			player.volume = 0.5;
		}
		
		function playMusic() {
        	var player = $("#player")[0]; /*jquery对象转换成js对象*/
        	if (player.paused){ /*如果已经暂停*/
            	player.play(); /*播放*/
        	}else {
           		player.pause();/*暂停*/
        	}
    	}

		function upVol(){
			var player = $("#player")[0];
			if (player.volume < 1) {
				player.volume += 0.1;
			}
		}
		
		function downVol(){
			var player = $("#player")[0];
			if (player.volume > 0) {
				player.volume -= 0.1;
			}
		}
		
		function dtime(){
			var player = $("#player")[0];
			var time = Math.round(player.currentTime);
			var totalM = Math.floor(player.duration / 60);
			var totalS = Math.floor(player.duration - totalM*60);
			alert(time+":second" + totalM + ":" + totalS);
		}
		
		function d(){
			var player = $("#player")[0];
			player.src = "audio/浮夸.mp3";
			//player.play();
		}
		
		function getProgress(){
			var player = $("#player")[0];
			var percent = parseInt((parseFloat(player.currentTime) / player.duration)*100);
			$(".progress").children().width(percent+"%");
		}
		
		
	</script>
</head>
	<body>
		<audio id="player" controls="controls"></audio>
		<button id="play">播放</button>
		<button onclick="upVol()">+</button>
		<button onclick="downVol()">-</button>
		<button onclick="dtime()">time</button>
		<button onclick="d()">切歌</button>
		<button id="q">qwe</button>
		<button id="next">next</button>
		<button id="last">last</button>
		<button id="pause">pause</button>
		<div>
			<input type="range" id="myRange">
		</div>
		<div style="width:300px">
			<div class="progress" id="pro">
				<div class="progress-bar progress-bar-success" role="progressbar" aria-valuenow="60" aria-valuemin="0" aria-valuemax="100" style="width: 9%;">
				</div>
			</div>
		</div>
	</body>
</html>
